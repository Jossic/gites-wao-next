{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jossi\\\\Dropbox\\\\JOSSIC\\\\6-development\\\\Devs\\\\gites-wao\\\\frontend\\\\pages\\\\admin\\\\messages\\\\[id].js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport AdminHeader from '../../../components/layout/AdminHeader';\nimport Admin from '../../../components/auth/Admin';\nimport dayjs from 'dayjs';\nimport { addResponse, listMessageById, setVu } from '../../../actions/messageActions';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport Paper from '@material-ui/core/Paper';\nimport Typography from '@material-ui/core/Typography';\nimport Divider from '@material-ui/core/Divider';\nimport IconButton from '@material-ui/core/IconButton';\nimport SendIcon from '@material-ui/icons/Send';\nimport TextareaAutosize from '@material-ui/core/TextareaAutosize';\nimport { useEffect, useState } from 'react';\nimport { getCookie } from '../../../actions/authActions';\nimport { withRouter } from 'next/router';\nimport BackspaceIcon from '@material-ui/icons/Backspace';\nimport Link from 'next/link';\nimport { useForm, Controller } from 'react-hook-form';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport MuiAlert from '@material-ui/lab/Alert';\nimport Router from 'next/router';\n\nfunction Alert(props) {\n  return __jsx(MuiAlert, _extends({\n    elevation: 6,\n    variant: \"filled\"\n  }, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 30,\n      columnNumber: 9\n    }\n  }));\n}\n\nconst useStyles = makeStyles(darkTheme => ({\n  root: {\n    minWidth: 275\n  },\n  rootPaper: {\n    padding: '6px 4px',\n    display: 'flex',\n    alignItems: 'center',\n    width: '100%',\n    backgroundColor: '#212529'\n  },\n  bullet: {\n    display: 'inline-block',\n    margin: '0 2px',\n    transform: 'scale(0.8)'\n  },\n  title: {\n    fontSize: 14\n  },\n  pos: {\n    marginBottom: 12\n  },\n  iconButton: {\n    padding: 10\n  },\n  input: {\n    marginLeft: darkTheme.spacing(1),\n    flex: 1\n  },\n  divider: {\n    height: 28,\n    margin: 4\n  }\n}));\n\nconst MessageId = ({\n  message,\n  router\n}) => {\n  const classes = useStyles();\n  const token = getCookie('token');\n  const {\n    control,\n    handleSubmit\n  } = useForm();\n  const {\n    0: values,\n    1: setValues\n  } = useState({\n    open: false,\n    loading: false,\n    success: '',\n    error: '',\n    text: ''\n  });\n  const {\n    success,\n    loading,\n    error,\n    text\n  } = values; //Envoyer la réponse\n  //UseEffect mettant vu à true au chargement de la page\n  //Afficher la réponse en dessous du message\n\n  useEffect(() => {\n    setVu(router.query.id, token);\n  }, []);\n\n  const handleClose = (event, reason) => {\n    if (reason === 'clickaway') {\n      return;\n    }\n\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      open: false\n    }));\n  };\n\n  const onSubmit = async data => {\n    setValues(_objectSpread(_objectSpread({}, values), {}, {\n      loading: true\n    }));\n    console.log('data vaut =>', data);\n    addResponse(data, router.query.id, token).then(result => {\n      console.log('result vaut =>', result);\n\n      if (result.error) {\n        console.log('une grosse erreur');\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          error: result.error\n        }));\n      } else {\n        setValues(_objectSpread(_objectSpread({}, values), {}, {\n          success: true,\n          loading: false,\n          open: true,\n          text: result.text\n        }));\n        setTimeout(() => {\n          Router.push('/admin/messages');\n        }, 3000);\n      }\n    });\n  };\n\n  return __jsx(React.Fragment, null, __jsx(AdminHeader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 4\n    }\n  }, __jsx(Admin, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 5\n    }\n  }, __jsx(\"h2\", {\n    style: {\n      color: 'white'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 6\n    }\n  }, \"Consultation du message de \", message.nom), __jsx(Link, {\n    href: \"/admin/messages\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 6\n    }\n  }, __jsx(\"a\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }\n  }, __jsx(BackspaceIcon, {\n    fontSize: \"large\",\n    style: {\n      float: 'right',\n      position: 'relative'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 8\n    }\n  }))), __jsx(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 6\n    }\n  }), __jsx(Card, {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 6\n    }\n  }, __jsx(CardContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 7\n    }\n  }, __jsx(Typography, {\n    variant: \"h5\",\n    component: \"h5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 8\n    }\n  }, \"Envoy\\xE9 par \", message.nom), __jsx(Typography, {\n    className: classes.title,\n    color: \"textSecondary\",\n    gutterBottom: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 8\n    }\n  }, \"le\", ' ', dayjs(message.createdAt).format('DD/MM/YYYY à HH:mm')), __jsx(Typography, {\n    className: classes.pos,\n    color: \"textSecondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 8\n    }\n  }, \"Coordonn\\xE9es :\", ' ', __jsx(\"a\", {\n    href: `mailto:${message.mail}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 9\n    }\n  }, message.mail), ' ', \"/ 0\", `${message.tel.toString().substring(0, 1)} ${message.tel.toString().substring(1, 3)} ${message.tel.toString().substring(3, 5)} ${message.tel.toString().substring(5, 7)} ${message.tel.toString().substring(7, 9)}`), __jsx(Typography, {\n    variant: \"body2\",\n    component: \"p\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 8\n    }\n  }, \"Message :\", __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 9\n    }\n  }), message.msg), __jsx(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 8\n    }\n  }), message.reponse && __jsx(Typography, {\n    variant: \"body2\",\n    component: \"p\",\n    style: {\n      textAlign: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  }, \"R\\xE9ponse le\", ' ', dayjs(message.dateReponse).format('DD/MM/YYYY à HH:mm'), \":\", __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 10\n    }\n  }), message.reponse)), !message.repondu && __jsx(CardContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 8\n    }\n  }, __jsx(Paper, {\n    component: \"form\",\n    className: classes.rootPaper,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 9\n    }\n  }, __jsx(\"form\", {\n    className: classes.rootPaper,\n    onSubmit: handleSubmit(onSubmit),\n    autoComplete: \"off\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 10\n    }\n  }, __jsx(Controller, {\n    name: \"reponse\",\n    control: control,\n    defaultValue: \"R\\xE9ponse au message\",\n    render: ({\n      onChange,\n      value\n    }) => __jsx(TextareaAutosize, {\n      style: {\n        width: '100%'\n      },\n      \"aria-label\": \"reponse\",\n      name: \"reponse\",\n      placeholder: \"R\\xE9ponse\",\n      rowsMin: 6,\n      onChange: onChange,\n      value: value,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 13\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 11\n    }\n  }), __jsx(Divider, {\n    className: classes.divider,\n    orientation: \"vertical\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 11\n    }\n  }), __jsx(IconButton, {\n    type: \"submit\",\n    color: \"primary\",\n    className: classes.iconButton,\n    \"aria-label\": \"Envoyer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 11\n    }\n  }, __jsx(SendIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 12\n    }\n  })))))), success && __jsx(Snackbar, {\n    open: open,\n    autoHideDuration: 6000,\n    onClose: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 7\n    }\n  }, __jsx(Alert, {\n    onClose: handleClose,\n    severity: \"success\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 8\n    }\n  }, text)), loading && __jsx(CircularProgress, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 18\n    }\n  }), error && __jsx(Snackbar, {\n    open: open,\n    autoHideDuration: 6000,\n    onClose: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 7\n    }\n  }, __jsx(Alert, {\n    onClose: handleClose,\n    severity: \"error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 8\n    }\n  }, error)))));\n};\n\nexport async function getServerSideProps(context) {\n  const res1 = await listMessageById(context.params.id);\n  const message = await res1;\n  return {\n    props: {\n      message\n    }\n  };\n}\nexport default withRouter(MessageId);","map":{"version":3,"sources":["C:/Users/jossi/Dropbox/JOSSIC/6-development/Devs/gites-wao/frontend/pages/admin/messages/[id].js"],"names":["AdminHeader","Admin","dayjs","addResponse","listMessageById","setVu","makeStyles","Card","CardContent","Paper","Typography","Divider","IconButton","SendIcon","TextareaAutosize","useEffect","useState","getCookie","withRouter","BackspaceIcon","Link","useForm","Controller","CircularProgress","Snackbar","MuiAlert","Router","Alert","props","useStyles","darkTheme","root","minWidth","rootPaper","padding","display","alignItems","width","backgroundColor","bullet","margin","transform","title","fontSize","pos","marginBottom","iconButton","input","marginLeft","spacing","flex","divider","height","MessageId","message","router","classes","token","control","handleSubmit","values","setValues","open","loading","success","error","text","query","id","handleClose","event","reason","onSubmit","data","console","log","then","result","setTimeout","push","color","nom","float","position","createdAt","format","mail","tel","toString","substring","msg","reponse","textAlign","dateReponse","repondu","onChange","value","getServerSideProps","context","res1","params"],"mappings":"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","sourcesContent":["import AdminHeader from '../../../components/layout/AdminHeader';\r\nimport Admin from '../../../components/auth/Admin';\r\nimport dayjs from 'dayjs';\r\nimport {\r\n\taddResponse,\r\n\tlistMessageById,\r\n\tsetVu,\r\n} from '../../../actions/messageActions';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Card from '@material-ui/core/Card';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport SendIcon from '@material-ui/icons/Send';\r\nimport TextareaAutosize from '@material-ui/core/TextareaAutosize';\r\nimport { useEffect, useState } from 'react';\r\nimport { getCookie } from '../../../actions/authActions';\r\nimport { withRouter } from 'next/router';\r\nimport BackspaceIcon from '@material-ui/icons/Backspace';\r\nimport Link from 'next/link';\r\nimport { useForm, Controller } from 'react-hook-form';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport MuiAlert from '@material-ui/lab/Alert';\r\nimport Router from 'next/router';\r\n\r\nfunction Alert(props) {\r\n\treturn <MuiAlert elevation={6} variant='filled' {...props} />;\r\n}\r\n\r\nconst useStyles = makeStyles((darkTheme) => ({\r\n\troot: {\r\n\t\tminWidth: 275,\r\n\t},\r\n\trootPaper: {\r\n\t\tpadding: '6px 4px',\r\n\t\tdisplay: 'flex',\r\n\t\talignItems: 'center',\r\n\t\twidth: '100%',\r\n\t\tbackgroundColor: '#212529',\r\n\t},\r\n\tbullet: {\r\n\t\tdisplay: 'inline-block',\r\n\t\tmargin: '0 2px',\r\n\t\ttransform: 'scale(0.8)',\r\n\t},\r\n\ttitle: {\r\n\t\tfontSize: 14,\r\n\t},\r\n\tpos: {\r\n\t\tmarginBottom: 12,\r\n\t},\r\n\ticonButton: {\r\n\t\tpadding: 10,\r\n\t},\r\n\tinput: {\r\n\t\tmarginLeft: darkTheme.spacing(1),\r\n\t\tflex: 1,\r\n\t},\r\n\tdivider: {\r\n\t\theight: 28,\r\n\t\tmargin: 4,\r\n\t},\r\n}));\r\n\r\nconst MessageId = ({ message, router }) => {\r\n\tconst classes = useStyles();\r\n\tconst token = getCookie('token');\r\n\tconst { control, handleSubmit } = useForm();\r\n\r\n\tconst [values, setValues] = useState({\r\n\t\topen: false,\r\n\t\tloading: false,\r\n\t\tsuccess: '',\r\n\t\terror: '',\r\n\t\ttext: '',\r\n\t});\r\n\tconst { success, loading, error, text } = values;\r\n\t//Envoyer la réponse\r\n\t//UseEffect mettant vu à true au chargement de la page\r\n\t//Afficher la réponse en dessous du message\r\n\r\n\tuseEffect(() => {\r\n\t\tsetVu(router.query.id, token);\r\n\t}, []);\r\n\r\n\tconst handleClose = (event, reason) => {\r\n\t\tif (reason === 'clickaway') {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetValues({ ...values, open: false });\r\n\t};\r\n\r\n\tconst onSubmit = async (data) => {\r\n\t\tsetValues({ ...values, loading: true });\r\n\t\tconsole.log('data vaut =>', data);\r\n\t\taddResponse(data, router.query.id, token).then((result) => {\r\n\t\t\tconsole.log('result vaut =>', result);\r\n\t\t\tif (result.error) {\r\n\t\t\t\tconsole.log('une grosse erreur');\r\n\t\t\t\tsetValues({ ...values, error: result.error });\r\n\t\t\t} else {\r\n\t\t\t\tsetValues({\r\n\t\t\t\t\t...values,\r\n\t\t\t\t\tsuccess: true,\r\n\t\t\t\t\tloading: false,\r\n\t\t\t\t\topen: true,\r\n\t\t\t\t\ttext: result.text,\r\n\t\t\t\t});\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tRouter.push('/admin/messages');\r\n\t\t\t\t}, 3000);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<AdminHeader>\r\n\t\t\t\t<Admin>\r\n\t\t\t\t\t{/* Fil d'ariane */}\r\n\t\t\t\t\t<h2 style={{ color: 'white' }}>\r\n\t\t\t\t\t\tConsultation du message de {message.nom}\r\n\t\t\t\t\t</h2>\r\n\t\t\t\t\t<Link href='/admin/messages'>\r\n\t\t\t\t\t\t<a>\r\n\t\t\t\t\t\t\t<BackspaceIcon\r\n\t\t\t\t\t\t\t\tfontSize='large'\r\n\t\t\t\t\t\t\t\tstyle={{ float: 'right', position: 'relative' }}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</a>\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<hr />\r\n\t\t\t\t\t<Card className={classes.root}>\r\n\t\t\t\t\t\t<CardContent>\r\n\t\t\t\t\t\t\t<Typography variant='h5' component='h5'>\r\n\t\t\t\t\t\t\t\tEnvoyé par {message.nom}\r\n\t\t\t\t\t\t\t</Typography>\r\n\t\t\t\t\t\t\t<Typography\r\n\t\t\t\t\t\t\t\tclassName={classes.title}\r\n\t\t\t\t\t\t\t\tcolor='textSecondary'\r\n\t\t\t\t\t\t\t\tgutterBottom>\r\n\t\t\t\t\t\t\t\tle{' '}\r\n\t\t\t\t\t\t\t\t{dayjs(message.createdAt).format(\r\n\t\t\t\t\t\t\t\t\t'DD/MM/YYYY à HH:mm'\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</Typography>\r\n\r\n\t\t\t\t\t\t\t<Typography\r\n\t\t\t\t\t\t\t\tclassName={classes.pos}\r\n\t\t\t\t\t\t\t\tcolor='textSecondary'>\r\n\t\t\t\t\t\t\t\tCoordonnées :{' '}\r\n\t\t\t\t\t\t\t\t<a href={`mailto:${message.mail}`}>\r\n\t\t\t\t\t\t\t\t\t{message.mail}\r\n\t\t\t\t\t\t\t\t</a>{' '}\r\n\t\t\t\t\t\t\t\t/ 0\r\n\t\t\t\t\t\t\t\t{`${message.tel\r\n\t\t\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t\t\t.substring(\r\n\t\t\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\t\t\t1\r\n\t\t\t\t\t\t\t\t\t)} ${message.tel\r\n\t\t\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t\t\t.substring(\r\n\t\t\t\t\t\t\t\t\t\t1,\r\n\t\t\t\t\t\t\t\t\t\t3\r\n\t\t\t\t\t\t\t\t\t)} ${message.tel\r\n\t\t\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t\t\t.substring(\r\n\t\t\t\t\t\t\t\t\t\t3,\r\n\t\t\t\t\t\t\t\t\t\t5\r\n\t\t\t\t\t\t\t\t\t)} ${message.tel\r\n\t\t\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t\t\t.substring(\r\n\t\t\t\t\t\t\t\t\t\t5,\r\n\t\t\t\t\t\t\t\t\t\t7\r\n\t\t\t\t\t\t\t\t\t)} ${message.tel\r\n\t\t\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t\t\t.substring(7, 9)}`}\r\n\t\t\t\t\t\t\t</Typography>\r\n\t\t\t\t\t\t\t<Typography variant='body2' component='p'>\r\n\t\t\t\t\t\t\t\tMessage :\r\n\t\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t\t{message.msg}\r\n\t\t\t\t\t\t\t</Typography>\r\n\r\n\t\t\t\t\t\t\t<hr />\r\n\t\t\t\t\t\t\t{message.reponse && (\r\n\t\t\t\t\t\t\t\t<Typography\r\n\t\t\t\t\t\t\t\t\tvariant='body2'\r\n\t\t\t\t\t\t\t\t\tcomponent='p'\r\n\t\t\t\t\t\t\t\t\tstyle={{ textAlign: 'right' }}>\r\n\t\t\t\t\t\t\t\t\tRéponse le{' '}\r\n\t\t\t\t\t\t\t\t\t{dayjs(message.dateReponse).format(\r\n\t\t\t\t\t\t\t\t\t\t'DD/MM/YYYY à HH:mm'\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\t\t\t{message.reponse}\r\n\t\t\t\t\t\t\t\t</Typography>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</CardContent>\r\n\t\t\t\t\t\t{!message.repondu && (\r\n\t\t\t\t\t\t\t<CardContent>\r\n\t\t\t\t\t\t\t\t<Paper\r\n\t\t\t\t\t\t\t\t\tcomponent='form'\r\n\t\t\t\t\t\t\t\t\tclassName={classes.rootPaper}>\r\n\t\t\t\t\t\t\t\t\t<form\r\n\t\t\t\t\t\t\t\t\t\tclassName={classes.rootPaper}\r\n\t\t\t\t\t\t\t\t\t\tonSubmit={handleSubmit(onSubmit)}\r\n\t\t\t\t\t\t\t\t\t\tautoComplete='off'>\r\n\t\t\t\t\t\t\t\t\t\t<Controller\r\n\t\t\t\t\t\t\t\t\t\t\tname='reponse'\r\n\t\t\t\t\t\t\t\t\t\t\tcontrol={control}\r\n\t\t\t\t\t\t\t\t\t\t\tdefaultValue='Réponse au message'\r\n\t\t\t\t\t\t\t\t\t\t\trender={({ onChange, value }) => (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<TextareaAutosize\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ width: '100%' }}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label='reponse'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname='reponse'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder='Réponse'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\trowsMin={6}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={onChange}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={value}\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t\t\t\t\t\t<Divider\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={classes.divider}\r\n\t\t\t\t\t\t\t\t\t\t\torientation='vertical'\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\t\t\t\t\ttype='submit'\r\n\t\t\t\t\t\t\t\t\t\t\tcolor='primary'\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={classes.iconButton}\r\n\t\t\t\t\t\t\t\t\t\t\taria-label='Envoyer'>\r\n\t\t\t\t\t\t\t\t\t\t\t<SendIcon />\r\n\t\t\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t\t\t</Paper>\r\n\t\t\t\t\t\t\t</CardContent>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</Card>\r\n\t\t\t\t\t{success && (\r\n\t\t\t\t\t\t<Snackbar\r\n\t\t\t\t\t\t\topen={open}\r\n\t\t\t\t\t\t\tautoHideDuration={6000}\r\n\t\t\t\t\t\t\tonClose={handleClose}>\r\n\t\t\t\t\t\t\t<Alert onClose={handleClose} severity='success'>\r\n\t\t\t\t\t\t\t\t{text}\r\n\t\t\t\t\t\t\t</Alert>\r\n\t\t\t\t\t\t</Snackbar>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t{loading && <CircularProgress />}\r\n\t\t\t\t\t{error && (\r\n\t\t\t\t\t\t<Snackbar\r\n\t\t\t\t\t\t\topen={open}\r\n\t\t\t\t\t\t\tautoHideDuration={6000}\r\n\t\t\t\t\t\t\tonClose={handleClose}>\r\n\t\t\t\t\t\t\t<Alert onClose={handleClose} severity='error'>\r\n\t\t\t\t\t\t\t\t{error}\r\n\t\t\t\t\t\t\t</Alert>\r\n\t\t\t\t\t\t</Snackbar>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</Admin>\r\n\t\t\t</AdminHeader>\r\n\t\t</>\r\n\t);\r\n};\r\n\r\nexport async function getServerSideProps(context) {\r\n\tconst res1 = await listMessageById(context.params.id);\r\n\tconst message = await res1;\r\n\r\n\treturn {\r\n\t\tprops: {\r\n\t\t\tmessage,\r\n\t\t},\r\n\t};\r\n}\r\n\r\nexport default withRouter(MessageId);\r\n"]},"metadata":{},"sourceType":"module"}